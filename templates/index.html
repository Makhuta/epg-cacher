{% extends "base.html" %}

{% block title %}Dashboard - EPG Channel Mapping Manager{% endblock %}

{% block content %}
<h2>Dashboard</h2>
<p>Overview of your channel mapping configuration.</p>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-number">{{ stats.total }}</div>
        <div class="stat-label">Total Channels</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ stats.mapped }}</div>
        <div class="stat-label">Mapped Channels</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ stats.unmapped }}</div>
        <div class="stat-label">Unmapped Channels</div>
    </div>
</div>

<div style="margin-top: 30px;">
    <h3>Quick Actions</h3>
    <p style="margin-bottom: 20px;">Get started with managing your channel mappings:</p>
    
    <a href="{{ url_for('mappings') }}" class="btn btn-success">
        Manage Channel Mappings
    </a>
    
    <button onclick="showEPG2Channels()" class="btn" style="margin-left: 10px;">
        View EPG2 Channels
    </button>
</div>

<div id="epg2ChannelsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 8px; max-width: 600px; max-height: 80%; overflow-y: auto;">
        <h3>Available EPG2 Channels</h3>
        <div id="epg2ChannelsList">Loading...</div>
        <button onclick="hideEPG2Channels()" class="btn" style="margin-top: 20px;">Close</button>
    </div>
</div>

<script>
function showEPG2Channels() {
    document.getElementById('epg2ChannelsModal').style.display = 'block';
    
    fetch('/api/epg2_channels')
        .then(response => response.json())
        .then(channels => {
            const listDiv = document.getElementById('epg2ChannelsList');
            
            if (channels.length === 0) {
                listDiv.innerHTML = '<p style="color: #666;">No EPG2 channels found. Run the EPG cacher with EPG2_URL configured to populate this list.</p>';
            } else {
                let html = `<p><strong>${channels.length} EPG2 channels available:</strong></p><ul style="max-height: 300px; overflow-y: auto; margin: 10px 0;">`;
                channels.forEach(channel => {
                    html += `<li style="margin: 5px 0;"><code>${channel.id}</code>`;
                    if (channel.name !== channel.id) {
                        html += ` - ${channel.name}`;
                    }
                    html += '</li>';
                });
                html += '</ul>';
                listDiv.innerHTML = html;
            }
        })
        .catch(error => {
            document.getElementById('epg2ChannelsList').innerHTML = '<p style="color: #e74c3c;">Error loading EPG2 channels.</p>';
        });
}

function hideEPG2Channels() {
    document.getElementById('epg2ChannelsModal').style.display = 'none';
}
</script>

<div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
    <h3>About Channel Mapping</h3>
    <p>
        Channel mapping allows you to correlate channels between different EPG sources. 
        The EPG1 source is your main EPG data, while EPG2 can provide additional information 
        like program images. Map the channel IDs from both sources to merge their data effectively.
    </p>
    <ul style="margin-top: 15px; padding-left: 20px;">
        <li><strong>EPG1 Channel ID:</strong> Channel identifier from your main EPG source</li>
        <li><strong>EPG2 Channel ID:</strong> Corresponding channel identifier from your image/secondary EPG source</li>
        <li><strong>Auto-Population:</strong> EPG1 channels are automatically populated when EPG data is fetched</li>
    </ul>
</div>
{% endblock %}